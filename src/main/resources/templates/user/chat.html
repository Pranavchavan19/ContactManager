
<!--<!DOCTYPE html>-->
<!--<html lang="en" th:replace="~{base :: parent(~{::#content}, ~{::title}, ~{::#script})}">-->
<!--<head>-->
<!--  <title id="title">Chat</title>-->
<!--  <style>-->
<!--    /* Hide scrollbar while still allowing scroll */-->
<!--    .hide-scrollbar {-->
<!--      scrollbar-width: none;          /* Firefox */-->
<!--      -ms-overflow-style: none;       /* IE 10+ */-->
<!--    }-->

<!--    .hide-scrollbar::-webkit-scrollbar {-->
<!--      display: none;                  /* Chrome, Safari */-->
<!--    }-->
<!--  </style>-->
<!--</head>-->
<!--<body class="bg-yellow-500 font-sans">-->

<!--  &lt;!&ndash; Full screen centered container &ndash;&gt;-->
<!--  <div id="content" class="w-full h-screen flex items-center justify-center p-4">-->

<!--    &lt;!&ndash; Chat container with 50% screen width &ndash;&gt;-->
<!--    <div class="w-1/4 h-full flex flex-col shadow-2xl rounded-2xl overflow-hidden bg-purple-900">-->

<!--      &lt;!&ndash; Header &ndash;&gt;-->
<!--      <h1 class="text-4xl font-bold text-center mt-4 text-white">ðŸ’¬ Direct Messages</h1>-->

<!--      &lt;!&ndash; Subheader &ndash;&gt;-->
<!--      <div class="bg-purple-700 text-white px-5 py-3">-->
<!--        <h2 class="text-lg font-thin">-->
<!--          Chat with <span th:text="${toUserName}" class="text-red-300 font-bold"></span>-->
<!--        </h2>-->
<!--      </div>-->

<!--      &lt;!&ndash; Main content: contacts + messages &ndash;&gt;-->
<!--      <div class="flex flex-row flex-1 overflow-hidden">-->

<!--        &lt;!&ndash; Contacts section &ndash;&gt;-->
<!--        <div class="w-3/2 bg-purple-600 text-white p-4 overflow-y-auto hide-scrollbar">-->
<!--          <div class="font-semibold text-lg mb-3">Contacts</div>-->
<!--          <ul class="space-y-1">-->
<!--            <li th:each="contact : ${contacts}">-->
<!--              <a-->
<!--                data-th-href="@{'/user/chat/' + ${contact.email}}"-->
<!--                data-th-text="${contact.name}"-->
<!--                class="block px-3 py-2 rounded hover:bg-purple-500 transition duration-200"-->
<!--              ></a>-->


<!--            </li>-->
<!--          </ul>-->
<!--        </div>-->

<!--        &lt;!&ndash; Messages panel &ndash;&gt;-->
<!--        <div class="w-3/12 flex flex-col bg-gray-800">-->

<!--          &lt;!&ndash; Scrollable messages &ndash;&gt;-->
<!--          <div class="flex-1 overflow-y-auto p-4 space-y-3 hide-scrollbar">-->
<!--            <div th:each="msg : ${messages}">-->

<!--              &lt;!&ndash; Message from contact &ndash;&gt;-->
<!--              <div th:if="${msg.fromUser == toUser}" class="flex items-start gap-2">-->
<!--                <div class="bg-gray-700 px-4 py-2 rounded-lg shadow max-w-xs">-->
<!--                  <p class="text-white" th:text="${msg.content}"></p>-->
<!--                  <span th:text="${#temporals.format(msg.timestamp, 'dd MMM yyyy, hh:mm a')}"-->
<!--                        class="block text-xs text-white mt-1 text-right"></span>-->
<!--                </div>-->
<!--              </div>-->

<!--              &lt;!&ndash; Message from current user &ndash;&gt;-->
<!--              <div th:if="${msg.fromUser != toUser}" class="flex justify-end items-start gap-2">-->
<!--                <div class="bg-green-800 text-white px-4 py-2 rounded-lg shadow max-w-xs">-->
<!--                  <p th:text="${msg.content}"></p>-->
<!--                  <span th:text="${#temporals.format(msg.timestamp, 'dd MMM yyyy, hh:mm a')}"-->
<!--                        class="block text-xs text-green-100 mt-1 text-right"></span>-->
<!--                </div>-->
<!--              </div>-->

<!--            </div>-->
<!--          </div>-->

<!--          &lt;!&ndash; Message input &ndash;&gt;-->
<!--          <form method="post" action="/user/chat/send" class="px-6 py-4 bg-gray-300 flex gap-3">-->
<!--            <input type="hidden" name="toUser" th:value="${toUser}" />-->
<!--            <input-->
<!--              type="text"-->
<!--              name="content"-->
<!--              placeholder="Type a message..."-->
<!--              class="flex-1 px-4 py-2 rounded-full text-green-700 border focus:ring-2 focus:ring-green-500"-->
<!--              required-->
<!--            />-->
<!--            <button-->
<!--              type="submit"-->
<!--              class="bg-green-600 hover:bg-green-700 text-white px-5 py-2 rounded-full font-semibold"-->
<!--            >-->
<!--              Send-->
<!--            </button>-->
<!--          </form>-->

<!--        </div>-->
<!--      </div>-->

<!--    </div>-->
<!--  </div>-->

<!--  &lt;!&ndash; Optional JS &ndash;&gt;-->
<!--  <div id="script" th:fragment="script">-->
<!--    <script>-->
<!--      console.log("Chat page loaded.");-->
<!--    </script>-->
<!--  </div>-->
<!--</body>-->
<!--</html>-->












<!--<!DOCTYPE html>-->
<!--<html lang="en" th:replace="~{base :: parent(~{::#content}, ~{::title}, ~{::#script})}">-->
<!--<head>-->
<!--  <title id="title">Chat</title>-->
<!--  <meta name="viewport" content="width=device-width, initial-scale=1.0" />-->
<!--  <style>-->
<!--    .hide-scrollbar {-->
<!--      scrollbar-width: none;-->
<!--      -ms-overflow-style: none;-->
<!--    }-->
<!--    .hide-scrollbar::-webkit-scrollbar {-->
<!--      display: none;-->
<!--    }-->
<!--    .hidden-mobile {-->
<!--      display: none;-->
<!--    }-->
<!--    @media (min-width: 1024px) {-->
<!--      .mobile-contact-panel {-->
<!--        transform: translateX(0) !important;-->
<!--        position: relative !important;-->
<!--        z-index: auto !important;-->
<!--      }-->
<!--    }-->
<!--  </style>-->
<!--</head>-->
<!--<body class="bg-yellow-500 font-sans">-->

<!--<div id="content" class="w-full h-screen flex items-center justify-center p-4">-->
<!--  <div class="w-full max-w-6xl h-full flex flex-col lg:flex-row bg-purple-900 rounded-2xl overflow-hidden shadow-2xl relative">-->

<!--    &lt;!&ndash; Mobile Header &ndash;&gt;-->
<!--    <div class="lg:hidden flex justify-between items-center bg-purple-700 text-white px-4 py-3">-->
<!--      <h2 class="text-base">Chat with <span th:text="${toUserName}" class="font-bold text-red-300"></span></h2>-->
<!--      <button onclick="openContacts()" class="text-2xl">â˜°</button>-->
<!--    </div>-->

<!--    &lt;!&ndash; Overlay &ndash;&gt;-->
<!--    <div id="overlay"-->
<!--         class="fixed inset-0 bg-black bg-opacity-40 z-40 lg:hidden hidden"-->
<!--         onclick="closeContacts()"></div>-->

<!--    &lt;!&ndash; Contact Panel &ndash;&gt;-->
<!--    <div id="contactPanel"-->
<!--         class="mobile-contact-panel fixed lg:static z-50 lg:z-0 inset-y-0 left-0 w-3/4 sm:w-1/2 lg:w-1/3 bg-purple-600 text-white p-4 overflow-y-auto hide-scrollbar transform -translate-x-full transition-transform duration-300 ease-in-out">-->
<!--      <div class="flex justify-between items-center mb-3">-->
<!--        <span class="text-lg font-semibold">Contacts</span>-->
<!--        <button onclick="closeContacts()" class="text-white text-3xl lg:hidden">&times;</button>-->
<!--      </div>-->
<!--      <ul class="space-y-1">-->
<!--        <li th:each="contact : ${contacts}">-->
<!--          <a data-th-href="@{'/user/chat/' + ${contact.email}}"-->
<!--             data-th-text="${contact.name}"-->
<!--             class="block px-3 py-2 rounded hover:bg-purple-500 transition duration-200"-->
<!--             onclick="closeContacts()"></a>-->
<!--        </li>-->
<!--      </ul>-->
<!--    </div>-->

<!--    &lt;!&ndash; Chat Panel &ndash;&gt;-->
<!--    <div class="flex-1 flex flex-col bg-gray-800">-->
<!--      <h1 class="hidden lg:block text-4xl font-bold text-center mt-4 text-white">ðŸ’¬ Direct Messages</h1>-->
<!--      <div class="hidden lg:block bg-purple-700 text-white px-5 py-3">-->
<!--        <h2 class="text-lg font-thin">Chat with <span th:text="${toUserName}" class="text-red-300 font-bold"></span></h2>-->
<!--      </div>-->
<!--      &lt;!&ndash; Messages &ndash;&gt;-->
<!--      <div class="flex-1 overflow-y-auto p-4 space-y-3 hide-scrollbar">-->
<!--        <div th:each="msg : ${messages}">-->
<!--          <div th:if="${msg.fromUser == toUser}" class="flex items-start gap-2">-->
<!--            <div class="bg-gray-700 px-4 py-2 rounded-lg shadow max-w-xs">-->
<!--              <p class="text-white" th:text="${msg.content}"></p>-->
<!--              <span th:text="${#temporals.format(msg.timestamp, 'dd MMM yyyy, hh:mm a')}"-->
<!--                    class="block text-xs text-white mt-1 text-right"></span>-->
<!--            </div>-->
<!--          </div>-->
<!--          <div th:if="${msg.fromUser != toUser}" class="flex justify-end items-start gap-2">-->
<!--            <div class="bg-green-800 text-white px-4 py-2 rounded-lg shadow max-w-xs">-->
<!--              <p th:text="${msg.content}"></p>-->
<!--              <span th:text="${#temporals.format(msg.timestamp, 'dd MMM yyyy, hh:mm a')}"-->
<!--                    class="block text-xs text-green-100 mt-1 text-right"></span>-->
<!--            </div>-->
<!--          </div>-->
<!--        </div>-->
<!--      </div>-->

<!--      &lt;!&ndash; Message Input &ndash;&gt;-->
<!--      <form method="post" action="/user/chat/send" class="px-6 py-4 bg-gray-300 flex gap-3">-->
<!--        <input type="hidden" name="toUser" th:value="${toUser}" />-->
<!--        <input-->
<!--                type="text"-->
<!--                name="content"-->
<!--                placeholder="Type a message..."-->
<!--                class="flex-1 px-4 py-2 rounded-full text-green-700 border focus:ring-2 focus:ring-green-500"-->
<!--                required-->
<!--        />-->
<!--        <button type="submit"-->
<!--                class="bg-green-600 hover:bg-green-700 text-white px-5 py-2 rounded-full font-semibold">-->
<!--          Send-->
<!--        </button>-->
<!--      </form>-->
<!--    </div>-->
<!--  </div>-->
<!--</div>-->

<!--&lt;!&ndash; Script &ndash;&gt;-->
<!--<div id="script" th:fragment="script">-->
<!--  <script>-->
<!--    function openContacts() {-->
<!--      document.getElementById('contactPanel').classList.remove('-translate-x-full');-->
<!--      document.getElementById('contactPanel').classList.add('translate-x-0');-->
<!--      document.getElementById('overlay').classList.remove('hidden');-->
<!--    }-->

<!--    function closeContacts() {-->
<!--      document.getElementById('contactPanel').classList.add('-translate-x-full');-->
<!--      document.getElementById('contactPanel').classList.remove('translate-x-0');-->
<!--      document.getElementById('overlay').classList.add('hidden');-->
<!--    }-->
<!--  </script>-->
<!--</div>-->
<!--</body>-->
<!--</html>-->















<!--<!DOCTYPE html>-->
<!--<html lang="en" th:replace="~{base :: parent(~{::#content}, ~{::title}, ~{::#script})}">-->
<!--<head>-->
<!--  <title id="title">Chat</title>-->
<!--  <meta name="viewport" content="width=device-width, initial-scale=1.0" />-->
<!--  <style>-->
<!--    .hide-scrollbar {-->
<!--      scrollbar-width: none;-->
<!--      -ms-overflow-style: none;-->
<!--    }-->
<!--    .hide-scrollbar::-webkit-scrollbar {-->
<!--      display: none;-->
<!--    }-->
<!--    @media (min-width: 1024px) {-->
<!--      .mobile-contact-panel {-->
<!--        transform: translateX(0) !important;-->
<!--        position: relative !important;-->
<!--        z-index: auto !important;-->
<!--      }-->
<!--    }-->
<!--  </style>-->
<!--</head>-->
<!--<body class="bg-yellow-500 font-sans">-->

<!--<div id="content" class="w-full min-h-screen flex flex-col p-4">-->
<!--  <div class="w-full max-w-6xl mx-auto flex flex-col lg:flex-row bg-purple-900 rounded-2xl overflow-hidden shadow-2xl relative flex-grow">-->

<!--    &lt;!&ndash; Mobile Header &ndash;&gt;-->
<!--    <div class="lg:hidden flex justify-between items-center bg-purple-700 text-white px-4  py-3">-->
<!--      <h2 class="text-base">Chat with <span th:text="${toUserName}" class="font-bold text-red-300"></span></h2>-->
<!--      <button onclick="openContacts()" class="text-2xl">â˜°</button>-->
<!--    </div>-->

<!--    &lt;!&ndash; Overlay &ndash;&gt;-->
<!--    <div id="overlay"-->
<!--         class="fixed inset-0 bg-black bg-opacity-40 z-40 lg:hidden hidden"-->
<!--         onclick="closeContacts()"></div>-->

<!--    &lt;!&ndash; Contact Panel &ndash;&gt;-->
<!--    <div id="contactPanel"-->
<!--         class="mobile-contact-panel fixed lg:static z-50 lg:z-0 inset-y-0 left-0 w-3/4 sm:w-1/2 lg:w-1/3 bg-purple-600 text-white p-4 overflow-y-auto hide-scrollbar transform -translate-x-full transition-transform duration-300 ease-in-out">-->
<!--&lt;!&ndash;    class="mobile-contact-panel fixed lg:static z-50 lg:z-0 inset-y-0 left-0 w-3/4 sm:w-1/2 lg:w-1/3 bg-purple-600 text-white p-4 overflow-y-auto hide-scrollbar transform lg:transform-none -translate-x-full transition-transform duration-300 ease-in-out"&ndash;&gt;-->

<!--    <div class="flex justify-between items-center mb-3">-->
<!--        <span class="text-lg font-semibold">Contacts</span>-->
<!--        <button onclick="closeContacts()" class="text-white text-3xl lg:hidden">&times;</button>-->
<!--      </div>-->
<!--      <ul class="space-y-1">-->
<!--        <li th:each="contact : ${contacts}">-->
<!--          <a data-th-href="@{'/user/chat/' + ${contact.email}}"-->
<!--             data-th-text="${contact.name}"-->
<!--             class="block px-3 py-2 rounded hover:bg-purple-500 transition duration-200"-->
<!--             onclick="closeContacts()"></a>-->
<!--        </li>-->
<!--      </ul>-->
<!--    </div>-->



<!--&lt;!&ndash;    <div th:if="${toUser != null}" class="flex-1 flex flex-col bg-gray-800">&ndash;&gt;-->
<!--&lt;!&ndash;      &lt;!&ndash; Desktop Header &ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;      <h1 class="hidden lg:block text-4xl font-bold text-center mt-4 text-white">ðŸ’¬ Direct Messages</h1>&ndash;&gt;-->

<!--&lt;!&ndash;      <div class="hidden lg:block bg-purple-700 text-white   px-5 py-3">&ndash;&gt;-->
<!--&lt;!&ndash;        <h2 class="text-lg font-thin">Chat with <span th:text="${toUserName}" class="text-red-300 font-bold"></span></h2>&ndash;&gt;-->
<!--&lt;!&ndash;      </div>&ndash;&gt;-->

<!--&lt;!&ndash;      &lt;!&ndash; Messages &ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;      <div class="flex-1 overflow-y-auto p-4 space-y-3 hide-scrollbar">&ndash;&gt;-->
<!--&lt;!&ndash;        <div th:each="msg : ${messages}">&ndash;&gt;-->
<!--&lt;!&ndash;          <div th:if="${msg.fromUser == toUser}" class="flex items-start gap-2">&ndash;&gt;-->
<!--&lt;!&ndash;            <div class="bg-gray-700 px-2 py-2 rounded-lg shadow max-w-xs">&ndash;&gt;-->
<!--&lt;!&ndash;              <p class="text-white" th:text="${msg.content}"></p>&ndash;&gt;-->
<!--&lt;!&ndash;              <span th:text="${#temporals.format(msg.timestamp, 'dd MMM yyyy, hh:mm a')}"&ndash;&gt;-->
<!--&lt;!&ndash;                    class="block text-xs text-white mt-1 text-right"></span>&ndash;&gt;-->
<!--&lt;!&ndash;            </div>&ndash;&gt;-->
<!--&lt;!&ndash;          </div>&ndash;&gt;-->
<!--&lt;!&ndash;          <div th:if="${msg.fromUser != toUser}" class="flex justify-end items-start gap-2">&ndash;&gt;-->
<!--&lt;!&ndash;            <div class="bg-green-800 text-white px-2 py-2 rounded-lg shadow max-w-xs">&ndash;&gt;-->
<!--&lt;!&ndash;              <p th:text="${msg.content}"></p>&ndash;&gt;-->
<!--&lt;!&ndash;              <span th:text="${#temporals.format(msg.timestamp, 'dd MMM yyyy, hh:mm a')}"&ndash;&gt;-->
<!--&lt;!&ndash;                    class="block text-xs text-green-100 mt-1 text-right"></span>&ndash;&gt;-->
<!--&lt;!&ndash;            </div>&ndash;&gt;-->
<!--&lt;!&ndash;          </div>&ndash;&gt;-->
<!--&lt;!&ndash;        </div>&ndash;&gt;-->
<!--&lt;!&ndash;      </div>&ndash;&gt;-->

<!--&lt;!&ndash;      &lt;!&ndash; Message Input &ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;      <form method="post" action="/user/chat/send"&ndash;&gt;-->
<!--&lt;!&ndash;            class="px-6 py-2 bg-gray-800 flex flex-wrap sm:flex-nowrap gap-3 items-center">&ndash;&gt;-->
<!--&lt;!&ndash;        <input type="hidden" name="toUser" th:value="${toUser}" />&ndash;&gt;-->

<!--&lt;!&ndash;        <input&ndash;&gt;-->
<!--&lt;!&ndash;                type="text"&ndash;&gt;-->
<!--&lt;!&ndash;                name="content"&ndash;&gt;-->
<!--&lt;!&ndash;                placeholder="Type a message..."&ndash;&gt;-->
<!--&lt;!&ndash;                class="flex-1 min-w-0 px-4 py-2 rounded-full bg-purple-700 text-green-700 border border-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500"&ndash;&gt;-->

<!--&lt;!&ndash;                required&ndash;&gt;-->
<!--&lt;!&ndash;        />&ndash;&gt;-->

<!--&lt;!&ndash;        <button&ndash;&gt;-->
<!--&lt;!&ndash;                type="submit"&ndash;&gt;-->
<!--&lt;!&ndash;                class="px-5 py-2 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-full whitespace-nowrap transition"&ndash;&gt;-->
<!--&lt;!&ndash;        >&ndash;&gt;-->
<!--&lt;!&ndash;          Send&ndash;&gt;-->
<!--&lt;!&ndash;        </button>&ndash;&gt;-->
<!--&lt;!&ndash;      </form>&ndash;&gt;-->
<!--&lt;!&ndash;    </div>&ndash;&gt;-->

<!--    <div class="flex-1 flex flex-col bg-gray-800">-->
<!--      &lt;!&ndash; Desktop Header &ndash;&gt;-->
<!--      <h1 class="hidden lg:block text-4xl font-bold text-center mt-4 text-white">ðŸ’¬ Direct Messages</h1>-->

<!--      <div class="hidden lg:block bg-purple-700 text-white px-5 py-3">-->
<!--        <h2 class="text-lg font-thin">-->
<!--          Chat with <span th:text="${toUserName}" class="text-red-300 font-bold">No User</span>-->
<!--        </h2>-->
<!--      </div>-->

<!--      &lt;!&ndash; Messages &ndash;&gt;-->
<!--      <div class="flex-1 overflow-y-auto p-4 space-y-3 hide-scrollbar">-->
<!--        <div th:if="${toUser != null}" th:each="msg : ${messages}">-->
<!--          &lt;!&ndash; incoming message &ndash;&gt;-->
<!--          <div th:if="${msg.fromUser == toUser}" class="flex items-start gap-2">-->
<!--            <div class="bg-gray-700 px-2 py-2 rounded-lg shadow max-w-xs">-->
<!--              <p class="text-white" th:text="${msg.content}"></p>-->
<!--              <span th:text="${#temporals.format(msg.timestamp, 'dd MMM yyyy, hh:mm a')}"-->
<!--                    class="block text-xs text-white mt-1 text-right"></span>-->
<!--            </div>-->
<!--          </div>-->

<!--          &lt;!&ndash; outgoing message &ndash;&gt;-->
<!--          <div th:if="${msg.fromUser != toUser}" class="flex justify-end items-start gap-2">-->
<!--            <div class="bg-green-800 text-white px-2 py-2 rounded-lg shadow max-w-xs">-->
<!--              <p th:text="${msg.content}"></p>-->
<!--              <span th:text="${#temporals.format(msg.timestamp, 'dd MMM yyyy, hh:mm a')}"-->
<!--                    class="block text-xs text-green-100 mt-1 text-right"></span>-->
<!--            </div>-->
<!--          </div>-->
<!--        </div>-->

<!--        <div th:if="${toUser == null}" class="text-center text-white text-lg mt-10">-->
<!--          ðŸ‘ˆ Please select a contact to start chatting.-->
<!--        </div>-->
<!--      </div>-->

<!--      &lt;!&ndash; Message Input &ndash;&gt;-->
<!--      <form th:if="${toUser != null}" method="post" action="/user/chat/send"-->
<!--            class="px-6 py-2 bg-gray-800 flex flex-wrap sm:flex-nowrap gap-3 items-center">-->
<!--        <input type="hidden" name="toUser" th:value="${toUser}" />-->
<!--        <input-->
<!--                type="text"-->
<!--                name="content"-->
<!--                placeholder="Type a message..."-->
<!--                class="flex-1 min-w-0 px-4 py-2 rounded-full bg-purple-700 text-green-700 border border-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500"-->
<!--                required-->
<!--        />-->
<!--        <button-->
<!--                type="submit"-->
<!--                class="px-5 py-2 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-full whitespace-nowrap transition"-->
<!--        >-->
<!--          Send-->
<!--        </button>-->
<!--      </form>-->
<!--    </div>-->


<!--  </div>-->

<!--&lt;!&ndash; Script &ndash;&gt;-->
<!--<div id="script" th:fragment="script">-->
<!--  <script>-->
<!--    function openContacts() {-->
<!--      document.getElementById('contactPanel').classList.remove('-translate-x-full');-->
<!--      document.getElementById('contactPanel').classList.add('translate-x-0');-->
<!--      document.getElementById('overlay').classList.remove('hidden');-->
<!--    }-->

<!--    function closeContacts() {-->
<!--      document.getElementById('contactPanel').classList.add('-translate-x-full');-->
<!--      document.getElementById('contactPanel').classList.remove('translate-x-0');-->
<!--      document.getElementById('overlay').classList.add('hidden');-->
<!--    }-->
<!--  </script>-->
<!--</div>-->
<!--</body>-->
<!--</html>-->





<!DOCTYPE html>
<html lang="en" th:replace="~{base :: parent(~{::#content}, ~{::title}, ~{::#script})}">
<head>
  <title id="title">Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    .hide-scrollbar {
      scrollbar-width: none;
      -ms-overflow-style: none;
    }
    .hide-scrollbar::-webkit-scrollbar {
      display: none;
    }

    @media (min-width: 1024px) {
      .mobile-contact-panel {
        transform: translateX(0) !important;
        position: relative !important;
        z-index: auto !important;
      }
    }
  </style>
</head>

<body class="bg-yellow-500 font-sans">

<div id="content" class=" mt-4 p-4 rounded-xl">
  <div class="   rounded-xl">

    <!-- Mobile Header -->
    <div class="lg:hidden flex justify-between items-center bg-purple-700 text-white px-4 py-3 rounded-full">
      <h2 class="text-base">Chat with <span th:text="${toUserName}" class="font-bold text-red-300"></span></h2>
      <button onclick="openContacts()" class="text-2xl">â˜°</button>
    </div>

    <!-- Overlay for mobile -->
    <div id="overlay" class="fixed inset-0 bg-black bg-opacity-40 z-40 lg:hidden hidden" onclick="closeContacts()"></div>

    <!-- Contact Panel -->
    <div id="contactPanel"
         class="mobile-contact-panel fixed lg:static z-50  lg:z-auto inset-y-0 left-0 w-3/4 sm:w-1/2 lg:w-1/3 bg-purple-600 text-white p-4 overflow-y-auto hide-scrollbar transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out">
      <div class="flex justify-between items-center mb-3">
        <span class="text-lg font-semibold">Contacts</span>
        <button onclick="closeContacts()" class="text-white text-3xl ">&times;</button>
      </div>
      <ul class="space-y-1">
        <li th:each="contact : ${contacts}">
          <a data-th-href="@{'/user/chat/' + ${contact.email}}"
             data-th-text="${contact.name}"
             class="block px-3 py-2 rounded hover:bg-purple-500 transition duration-200"
             onclick="closeContacts()"></a>
        </li>
      </ul>
    </div>

    <!-- Chat Area -->
    <div class="flex-1 flex flex-col bg-gray-800 rounded-lg mt-4">
      <!-- Desktop Header -->
      <h1 class="hidden lg:block text-4xl font-bold text-center mt-4 text-white">ðŸ’¬ Direct Messages</h1>

      <div class="hidden lg:block bg-purple-700 text-white px-5 py-3">
        <h2 class="text-lg font-thin">
          Chat with <span th:text="${toUserName}" class="text-red-300 font-bold">No User</span>
        </h2>
      </div>

      <!-- Messages -->
      <div class="flex-1 overflow-y-auto p-4 space-y-3 hide-scrollbar">
        <div th:if="${toUser != null}" th:each="msg : ${messages}">



          <!-- Incoming -->

<!--          <div th:if="${msg.fromUser == toUser}" class="flex items-start gap-2">-->
          <div th:if="${msg.fromUser.equals(toUser)}" class="flex items-start gap-2">

          <div class="bg-gray-700 px-2 py-2 rounded-lg shadow max-w-xs">
              <p class="text-white" th:text="${msg.content}"></p>
              <span th:text="${#temporals.format(msg.timestamp, 'dd MMM yyyy, hh:mm a')}"
                    class="block text-xs text-white mt-1 text-right"></span>
            </div>
          </div>
          <!-- Outgoing -->
<!--          <div th:if="${msg.fromUser != toUser}" class="flex justify-end items-start gap-2">-->
          <div th:if="${!msg.fromUser.equals(toUser)}" class="flex justify-end items-start gap-2">

          <div class="bg-green-800 text-white px-2 py-2 rounded-lg shadow max-w-xs">
              <p th:text="${msg.content}"></p>
              <!-- <span th:text="${#temporals.format(msg.timestamp, 'dd MMM yyyy, hh:mm a')}"
                    class="block text-xs text-green-100 mt-1 text-right"></span> -->
              <span th:text="${#temporals.format(msg.timestamp, 'dd MMM yyyy, hh:mm a')}"
                    class="block text-xs text-white mt-1 text-right"></span>

            </div>
          </div>
        </div>

        <!-- No Chat Yet -->
        <div th:if="${toUser == null}" class="text-center text-white text-lg mt-10">
          ðŸ‘ˆ Please select a contact to start chatting.
        </div>
      </div>


<!--       Message Input-->
      <form th:if="${toUser != null}" method="post" action="/user/chat/send"
            class="px-6 py-2 bg-gray-800 flex flex-wrap sm:flex-nowrap gap-3 items-center rounded-lg">
        <input type="hidden" name="toUser" th:value="${toUser}" />
        <input
                type="text"
                name="content"
                placeholder="Type a message..."
                class="flex-1 min-w-0 px-4 py-2 rounded-full bg-purple-700 text-white border border-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500"
                required
        />
        <button
                id="sendBtn"
                type="submit"
                class="px-5 py-2 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-full whitespace-nowrap transition"
        >
          Send
        </button>
      </form>


    </div>

  </div>
</div>

<!-- Scripts -->
<!--<div id="script" th:fragment="script">-->
<!--  <script>-->
<!--    function openContacts() {-->
<!--      document.getElementById('contactPanel').classList.remove('-translate-x-full');-->
<!--      document.getElementById('contactPanel').classList.add('translate-x-0');-->
<!--      document.getElementById('overlay').classList.remove('hidden');-->
<!--    }-->

<!--    function closeContacts() {-->
<!--      document.getElementById('contactPanel').classList.add('-translate-x-full');-->
<!--      document.getElementById('contactPanel').classList.remove('translate-x-0');-->
<!--      document.getElementById('overlay').classList.add('hidden');-->
<!--    }-->
<!--  </script>-->
<!--  <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>-->
<!--  <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>-->

<!--  <script>-->
<!--    let stompClient = null;-->
<!--    let currentUser = /*[[${#httpServletRequest.remoteUser}]]*/ '';  // Thymeleaf or assign current user manually-->
<!--    let receiver = ''; // You set this to the contact you're chatting with-->

<!--    function connect() {-->
<!--        const socket = new SockJS('/ws'); // '/ws' must match your WebSocketConfig-->
<!--        stompClient = Stomp.over(socket);-->
<!--        stompClient.connect({}, function (frame) {-->
<!--            console.log('Connected: ' + frame);-->

<!--            // Subscribe to your inbox-->
<!--            stompClient.subscribe('/topic/messages/' + currentUser, function (messageOutput) {-->
<!--                const message = JSON.parse(messageOutput.body);-->
<!--                showMessage(message);-->
<!--            });-->
<!--        });-->
<!--    }-->

<!--    function sendMessage() {-->
<!--        const msg = {-->
<!--            fromUser: currentUser,-->
<!--            toUser: receiver,-->
<!--            content: document.getElementById("messageInput").value-->
<!--        };-->
<!--        stompClient.send("/app/chat", {}, JSON.stringify(msg));-->
<!--        document.getElementById("messageInput").value = '';-->
<!--    }-->

<!--    function showMessage(message) {-->
<!--        const messageBox = document.getElementById("chatBox");-->
<!--        const div = document.createElement("div");-->
<!--        div.textContent = message.fromUser + ": " + message.content;-->
<!--        messageBox.appendChild(div);-->
<!--        messageBox.scrollTop = messageBox.scrollHeight;-->
<!--    }-->

<!--    window.onload = connect;-->
<!--  </script>-->

<!--</div>-->

<!-- Scripts -->
<div id="script" th:fragment="script">
  <!-- Contact panel toggle script -->
  <script>
    function openContacts() {
      document.getElementById('contactPanel').classList.remove('-translate-x-full');
      document.getElementById('contactPanel').classList.add('translate-x-0');
      document.getElementById('overlay').classList.remove('hidden');
    }

    function closeContacts() {
      document.getElementById('contactPanel').classList.add('-translate-x-full');
      document.getElementById('contactPanel').classList.remove('translate-x-0');
      document.getElementById('overlay').classList.add('hidden');
    }
  </script>

  <!-- SockJS and STOMP libraries -->
  <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>


  <script th:src="@{/js/websocket-chat.js}" defer></script>

</div>



</body>
</html>

